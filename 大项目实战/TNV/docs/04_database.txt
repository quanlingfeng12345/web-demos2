========
库表结构
========

1. 跟踪服务器数据库：tnv_trackerdb
----------------------------------

t_groups_info
+----+------------+---------------------+---------------------+
| id | group_name | create_time         | update_time         |
+----+------------+---------------------+---------------------+
|  1 | group001   | 2020-11-01 12:53:56 | 2020-11-01 12:53:56 |
+----+------------+---------------------+---------------------+

t_router
+----+---------+--------+------------+---------------------+---------------------+
| id | appid   | userid | group_name | create_time         | update_time         |
+----+---------+--------+------------+---------------------+---------------------+
|  1 | tnvideo | tnv001 | group001   | 2020-11-01 12:55:03 | 2020-11-01 12:55:03 |
+----+---------+--------+------------+---------------------+---------------------+

跟踪服务器在处理来自客户机的，获取存储服务器地址列表的请求时，先查询
t_router表，根据用户ID(userid)获取其对应的组名(group_name)，再于该组中查
找处于活动状态的存储服务器。若t_router表中没有与该用户对应的组，则从
t_groups_info表中获取全部组名，随机抽取一个，分配给该用户，并记入
t_router表。

2. ID服务器数据库：tnv_idsdb
----------------------------

t_id_gen
+---------+----------+---------------------+---------------------+
| id      | id_value | create_time         | update_time         |
+---------+----------+---------------------+---------------------+
| ../data |      100 | 2020-11-01 12:55:03 | 2020-11-01 12:55:03 |
+---------+----------+---------------------+---------------------+

ID服务器采用键(id)值(id_value)对的形式管理保存在每个存储路径下的文件的ID
号。该ID号将参与生成文件在存储路径下的各级子目录和文件名，如：

../data/000/000/000/5F9E3FA7_000
\_____/ \_/ \_/ \_/ \______/ \_/
   |     |___|___|_____|______|_________
   v                   v                v
存储路径            时间戳   源自ID服务器生成的文件ID

针对与每个键相对应的ID值，ID服务器采取内存累加，数据库步进的方式，同时兼
顾唯一性和效率。

内  存： 0 1 2 ... 99 100 101 102 ... 199 200 201 202 ...
数据库：100           100                 200
                      200                 300

3. 存储服务器数据库：tnv_storagedb
----------------------------------

t_file_01
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| id                                   | appid   | userid | status | file_path                        | file_size | create_time         | update_time         |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| 5f9e3fa7085e5aa25387c8cf7b5f29000117 | tnvideo | tnv001 |      0 | ../data/000/000/000/5F9E3FA7_000 | 734529655 | 2020-11-01 12:55:14 | 2020-11-01 12:55:14 |
| 5f9e3fbd0c1ae14107aa20f9b360cd000131 | tnvideo | tnv001 |      0 | ../data/000/000/000/5F9E3FBD_001 | 791640904 | 2020-11-01 12:55:37 | 2020-11-01 12:55:37 |
| 5f9e3fd10c4328823b46396d056950000197 | tnvideo | tnv001 |      0 | ../data/000/000/000/5F9E3FD1_002 | 780371228 | 2020-11-01 12:55:57 | 2020-11-01 12:55:57 |
| 5f9e3fe00b8db7040fdf13ca069961000132 | tnvideo | tnv001 |      0 | ../data/000/000/000/5F9E3FE0_003 | 823321222 | 2020-11-01 12:56:13 | 2020-11-01 12:56:13 |
| 5f9e3ff300edbc468eafe196475dc7000149 | tnvideo | tnv001 |      0 | ../data/000/000/000/5F9E3FF3_004 | 859620453 | 2020-11-01 12:56:31 | 2020-11-01 12:56:31 |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+

t_file_02
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| id                                   | appid   | userid | status | file_path                        | file_size | create_time         | update_time         |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+

t_file_03
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+
| id                                   | appid   | userid | status | file_path                        | file_size | create_time         | update_time         |
+--------------------------------------+---------+--------+--------+----------------------------------+-----------+---------------------+---------------------+

t_file_xx表记录了文件ID(id)和路径(file_path)及大小(file_size)的对应关系。
这里的文件ID并非由ID服务器生成，而是客户端提供的便于日后访问该文件的标识
号。为了保证其唯一性，在算法中包含了用户ID、进程ID、线程ID、时间戳、计数
值和随机量等信息。

用户ID 进程ID 线程ID 随机数
\_________________________/
             |MD5
             v
   时间戳 数字摘要 计数值 随机数
   \___________________________/
                 |
                 v
              文件ID

不同用户上传的文件会被记录在不同的表中，表名的最后两个字符(xx)，由用户ID
的哈希值计算得到。
